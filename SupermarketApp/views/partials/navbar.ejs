<% const currentUser = typeof user === 'undefined' ? null : user; %>
<header class="app-header">
  <div class="nav-shell">
    <a class="brand-logo" href="<%= currentUser && currentUser.role === 'admin' ? '/admin/dashboard' : '/' %>">Tan's Supermarket</a>

    <ul class="nav-list">
      <% if (currentUser && currentUser.role === 'admin') { %>
        <li><a href="/admin/dashboard">Dashboard</a></li>
        <li><a href="/inventory">Inventory</a></li>
        <li><a href="/addProduct">Add Products</a></li>
        <li><a href="/admin/users">Users</a></li>
        <li><a href="/admin/orders">All Orders</a></li>
        <li>
          <a href="/admin/refunds">
            Refunds
            <% if (typeof pendingRefundCount !== 'undefined' && pendingRefundCount > 0) { %>
              (<%= pendingRefundCount %>)
            <% } %>
          </a>
        </li>
        <li><a href="/profile">Profile</a></li>
      <% } else if (currentUser) { %>
        <li><a href="/">Home</a></li>
        <li><a href="/shopping">Shop</a></li>
        <li><a href="/orders">Orders</a></li>
        <li><a href="/profile">Profile</a></li>
      <% } else { %>
        <li><a href="/">Home</a></li>
        <li><a href="/shopping">Shop</a></li>
        <li><a href="/orders">Orders</a></li>
      <% } %>
    </ul>

    <div class="nav-cta">
      <% if (currentUser) { %>
        <div class="user-greeting">
          <span class="avatar-circle"><%= currentUser.username ? currentUser.username.charAt(0).toUpperCase() : 'U' %></span>
          <span>
            Hi, <strong><%= currentUser.username || 'User' %></strong>
            <span class="badge-pill"><%= String(currentUser.role || '').trim().toUpperCase() %></span>
          </span>
        </div>
        <% if (currentUser.role !== 'admin') { %>
          <a class="btn btn-secondary cart-btn" href="/cart">
            Cart
            <% if (typeof cartCount !== 'undefined') { %>
              <span class="cart-badge"><%= cartCount %></span>
            <% } %>
          </a>
        <% } %>
        <a class="btn btn-primary" href="/logout">Logout</a>
      <% } else { %>
        <a class="btn btn-secondary cart-btn" href="/cart">
          Cart
          <% if (typeof cartCount !== 'undefined') { %>
            <span class="cart-badge"><%= cartCount %></span>
          <% } %>
        </a>
        <a class="btn btn-secondary" href="/login">Login</a>
        <a class="btn btn-primary" href="/register">Create Account</a>
      <% } %>
    </div>
  </div>
</header>
