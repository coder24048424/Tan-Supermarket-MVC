<%- include('partials/head', { pageTitle: "Your Tan's Supermarket cart", bodyClass: 'page-cart' }) %>

<section class="glass-panel">
  <div class="d-flex justify-content-between flex-wrap align-items-center gap-2 mb-3">
    <div>
      <h2 class="section-title mb-1">Cart overview</h2>
      <p class="subtle-text mb-0">Refined list layout and cozy cards -- mirroring the Dribbble concept.</p>
    </div>
    <a class="btn btn-secondary" href="/shopping">Continue shopping</a>
  </div>

  <% if (errors && errors.length) { %>
    <div class="toast error mb-3">
      <% errors.forEach(message => { %><div><%= message %></div><% }) %>
    </div>
  <% } %>
  <% if (success && success.length) { %>
    <div class="toast success mb-3">
      <% success.forEach(message => { %><div><%= message %></div><% }) %>
    </div>
  <% } %>

  <% if (cart.length === 0) { %>
    <div class="empty-state">
      <h4>Your cart is empty</h4>
      <p>Discover fresh picks and artisan treats.</p>
      <a class="btn btn-primary mt-2" href="/shopping">Browse catalog</a>
    </div>
  <% } else { %>
    <% let total = 0; %>
    <% cart.forEach(item => { total += item.price * item.quantity; }); %>

    <div class="split-layout">
      <div class="d-flex flex-column gap-3">
        <% cart.forEach(item => { %>
          <div class="inventory-card">
            <div class="d-flex gap-3 align-items-center">
              <img src="/images/<%= item.image %>" alt="<%= item.productName %>" style="width:90px;height:90px;object-fit:cover;border-radius:20px;">
              <div class="flex-grow-1">
                <div class="d-flex justify-content-between align-items-start">
                  <div>
                    <h4 class="mb-1"><%= item.productName %></h4>
                    <p class="subtle-text mb-0">Qty: <strong><%= item.quantity %></strong></p>
                  </div>
                  <span class="price-tag">$<%= (item.price * item.quantity).toFixed(2) %></span>
                </div>
                <div class="d-flex gap-2 mt-2">
                  <a class="btn btn-link text-danger" href="/remove-from-cart/<%= item.productId %>" onclick="return confirm('Remove this item from cart?')">Remove</a>
                  <span class="chip">$<%= item.price.toFixed(2) %> each</span>
                </div>
              </div>
            </div>
          </div>
        <% }) %>
      </div>

      <div class="summary-card">
        <h3 class="mb-3">Order summary</h3>
        <div class="summary-row">
          <span>Items</span>
          <span><%= cart.length %></span>
        </div>
        <div class="summary-row">
          <span>Subtotal</span>
          <span>$<%= total.toFixed(2) %></span>
        </div>
        <div class="summary-row">
          <span>Delivery</span>
          <span class="badge-pill">Free</span>
        </div>
        <div class="summary-row summary-total">
          <span>Total</span>
          <span>$<%= total.toFixed(2) %></span>
        </div>
        <a class="btn btn-primary w-100 mt-3" href="/checkout">Go to checkout</a>
      </div>
    </div>
  <% } %>
</section>

<%- include('partials/footer') %>
