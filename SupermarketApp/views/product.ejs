<%- include('partials/head', { pageTitle: 'Product details', bodyClass: 'page-product' }) %>

<section class="glass-panel">
  <% if (!product) { %>
    <div class="empty-state">
      <h4>Product not found</h4>
      <a class="btn btn-secondary mt-2" href="/shopping">Back to shopping</a>
    </div>
  <% } else { %>
    <div class="split-layout align-items-center">
      <div>
        <img src="/images/<%= product.image %>" alt="<%= product.productName %>" style="width:100%;border-radius:30px;object-fit:cover;">
      </div>
      <div class="d-flex flex-column gap-3">
        <div>
          <span class="badge-pill"><%= user.role %> view</span>
          <h2 class="section-title mb-1"><%= product.productName %></h2>
          <p class="subtle-text mb-0">A closer look with premium presentation.</p>
        </div>
        <div class="glass-panel">
          <div class="summary-row">
            <span>Price</span>
            <span class="price-tag">$<%= product.price.toFixed(2) %></span>
          </div>
          <div class="summary-row">
            <span>Available</span>
            <span><%= product.quantity %> units</span>
          </div>
        </div>
        <% if (user.role === 'admin') { %>
          <div class="d-flex gap-2">
            <a class="btn btn-secondary" href="/inventory">Back to inventory</a>
            <a class="btn btn-primary" href="/updateProduct/<%= product.id %>">Edit product</a>
          </div>
        <% } else { %>
          <div class="d-flex gap-2">
            <a class="btn btn-secondary" href="/shopping">Back to catalog</a>
            <form action="/add-to-cart/<%= product.id %>" method="POST" class="d-flex gap-2">
              <select name="quantity" class="form-select" style="width:110px;">
                <% for (let q = 1; q <= Math.min(5, product.quantity || 5); q++) { %>
                  <option value="<%= q %>"><%= q %></option>
                <% } %>
              </select>
              <button class="btn btn-primary" type="submit">Add to cart</button>
            </form>
          </div>
        <% } %>
      </div>
    </div>
  <% } %>
</section>

<%- include('partials/footer') %>
