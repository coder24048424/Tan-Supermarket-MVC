<%- include('partials/head', { pageTitle: "Tan's Supermarket | Fresh groceries in minutes", bodyClass: 'page-home' }) %>

<section class="hero home-hero">
  <div class="hero-content">
    <span class="badge-pill">Tan's Supermarket</span>
    <h1>Fresh picks stacked high with color.</h1>
    <p>Scroll through vibrant produce mosaics inspired by the design reference, then jump straight into your shopping flow.</p>

    <div class="hero-gallery mt-4">
      <div class="tile"><img src="/images/apples.png" alt="Apples"></div>
      <div class="tile"><img src="/images/bananas.png" alt="Bananas"></div>
      <div class="tile"><img src="/images/broccoli.png" alt="Broccoli"></div>
      <div class="tile"><img src="/images/tomatoes.png" alt="Tomatoes"></div>
    </div>
    <div class="hero-card hero-card-inline">
      <% if (!user) { %>
        <h3>Join the market</h3>
        <p class="subtle-text">Sign in or create an account to start building your basket.</p>
        <div class="cta-group">
          <a class="btn btn-primary" href="/login">Login</a>
          <a class="btn btn-secondary" href="/register">Create account</a>
        </div>
      <% } else { %>
        <h3>Welcome back, <%= user.username %></h3>
        <p class="subtle-text mb-3">Ready to keep curating your cart?</p>
        <% if (user.role === 'admin') { %>
          <div class="cta-group">
            <a class="btn btn-primary" href="/inventory">Manage inventory</a>
            <a class="btn btn-secondary" href="/addProduct">Add product</a>
          </div>
        <% } else { %>
          <div class="cta-group">
            <a class="btn btn-primary" href="/shopping">Shop now</a>
            <a class="btn btn-secondary" href="/orders">View orders</a>
          </div>
        <% } %>
      <% } %>
    </div>
  </div>
</section>

<section class="glass-panel">
  <div class="d-flex justify-content-between flex-wrap align-items-center mb-3">
    <div>
      <h2 class="section-title">Top seller this week</h2>
      <p class="subtle-text mb-0">Straight from Tan's Supermarket sales board.</p>
    </div>
    <% if (bestSeller) { %>
      <a class="btn btn-secondary" href="/product/<%= bestSeller.id %>">View product</a>
    <% } %>
  </div>

  <% if (!bestSeller) { %>
    <div class="empty-state">
      <p>Add products to spotlight a top seller.</p>
    </div>
  <% } else { %>
    <div class="split-layout align-items-center">
      <div>
        <img src="/images/<%= bestSeller.image %>" alt="<%= bestSeller.productName %>" style="width:100%;border-radius:30px;object-fit:cover;">
      </div>
      <div class="d-flex flex-column gap-3">
        <div>
          <span class="chip">Bestseller</span>
          <h3 class="section-title mb-1"><%= bestSeller.productName %></h3>
          <p class="subtle-text mb-0">Price: $<%= bestSeller.price.toFixed(2) %>. Available units: <%= bestSeller.quantity %>.</p>
        </div>
        <a class="btn btn-primary" href="/product/<%= bestSeller.id %>">See details</a>
      </div>
    </div>
  <% } %>
</section>

<section class="glass-panel category-showcase text-center">
  <div class="mb-4">
    <h2 class="section-title mb-1">Shop by category</h2>
    <p class="subtle-text mb-3">Bold cards with just the essentials, centered for quick browsing.</p>
    <a class="btn btn-secondary" href="/shopping">Browse Catalog</a>
  </div>

  <% if (!categories || !categories.length) { %>
    <div class="empty-state">
      <p>No categories available. Add products to populate this section.</p>
    </div>
  <% } else { %>
    <div class="category-grid">
      <% categories.forEach(category => { %>
        <% if (category.items.length) { %>
          <% const hero = category.items[0]; %>
          <div class="category-card">
            <div class="category-image">
              <img src="/images/<%= hero.image %>" alt="<%= hero.productName %>">
            </div>
            <span class="chip"><%= category.name %></span>
            <ul class="list-unstyled m-0 mt-3">
              <% category.items.slice(0, 3).forEach(item => { %>
                <li class="subtle-text mb-1">- <%= item.productName %></li>
              <% }) %>
            </ul>
            <a class="btn btn-link mt-2" href="/shopping?<%= `category=${encodeURIComponent(category.name)}` %>">View all</a>
          </div>
        <% } %>
      <% }) %>
    </div>
  <% } %>
</section>

<%- include('partials/footer') %>
