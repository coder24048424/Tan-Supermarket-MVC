<%- include('partials/head', { pageTitle: "Tan's Supermarket | Fresh groceries in minutes", bodyClass: 'page-home' }) %>

<section class="hero home-hero">
  <div class="hero-content">
    <span class="badge-pill">Tan's Supermarket</span>
    <h1>Fresh finds for every kind of day.</h1>
    <p>Seasonal picks, pantry staples, and bold flavors&mdash;curated fast so you can get back to what matters.</p>

    <div class="hero-card hero-card-inline mb-4">
      <% if (!user) { %>
        <h3>Welcome to Tan's Supermarket</h3>
        <p class="subtle-text">Log in to start exploring the market.</p>
        <a class="btn btn-primary mt-2" href="/login">Login</a>
      <% } else { %>
        <h3>Welcome back, <%= user.username %></h3>
        <p class="subtle-text mb-0">Glad to have you back in the aisles.</p>
      <% } %>
    </div>
  </div>
</section>

<section class="glass-panel">
  <div class="d-flex justify-content-between flex-wrap align-items-center mb-3">
    <div>
      <h2 class="section-title">What's new</h2>
      <p class="subtle-text mb-0">Fresh arrivals pulled straight from our shelves.</p>
    </div>
    <% if (newProducts && newProducts.length) { %>
      <a class="btn btn-secondary" href="/shopping">View all</a>
    <% } %>
  </div>

  <% if (!newProducts || !newProducts.length) { %>
    <div class="empty-state">
      <p>No new products yet. Add one to showcase it here.</p>
    </div>
  <% } else { %>
    <div class="card-grid">
      <% newProducts.forEach(product => { %>
        <div class="product-card">
          <span class="chip">New arrival</span>
          <img src="/images/<%= product.image %>" alt="<%= product.productName %>">
          <h3><%= product.productName %></h3>
          <p class="subtle-text mb-0">In stock: <%= product.quantity %></p>
          <div class="d-flex justify-content-between align-items-center">
            <span class="price-tag">$<%= Number(product.price || 0).toFixed(2) %></span>
            <a class="btn btn-link" href="/product/<%= product.id %>">See details</a>
          </div>
        </div>
      <% }); %>
    </div>
  <% } %>
</section>

<section class="glass-panel">
  <div class="d-flex justify-content-between flex-wrap align-items-center mb-3">
    <div>
      <h2 class="section-title">Top seller this week</h2>
      <p class="subtle-text mb-0">Straight from Tan's Supermarket sales board.</p>
    </div>
    <% if (bestSeller) { %>
      <a class="btn btn-secondary" href="/product/<%= bestSeller.id %>">View product</a>
    <% } %>
  </div>

  <% if (!bestSeller) { %>
    <div class="empty-state">
      <p>Add products to spotlight a top seller.</p>
    </div>
  <% } else { %>
    <div class="split-layout align-items-center">
      <div>
        <img src="/images/<%= bestSeller.image %>" alt="<%= bestSeller.productName %>" style="width:100%;border-radius:30px;object-fit:cover;">
      </div>
      <div class="d-flex flex-column gap-3">
        <div>
          <span class="chip">Bestseller</span>
          <h3 class="section-title mb-1"><%= bestSeller.productName %></h3>
          <p class="subtle-text mb-0">Price: $<%= bestSeller.price.toFixed(2) %>. Available units: <%= bestSeller.quantity %>.</p>
        </div>
        <a class="btn btn-primary" href="/product/<%= bestSeller.id %>">See details</a>
      </div>
    </div>
  <% } %>
</section>

<% if (user) { %>
  <section class="glass-panel">
    <div class="d-flex justify-content-between flex-wrap align-items-center mb-3">
      <div>
        <h2 class="section-title">Frequent buys</h2>
        <p class="subtle-text mb-0">Items you reach for most often, ready to re-add.</p>
      </div>
      <a class="btn btn-secondary" href="/shopping">Browse catalog</a>
    </div>

    <% const frequent = []; if (categories && categories.length) { categories.forEach(cat => { (cat.items || []).slice(0,1).forEach(item => frequent.push(item)); }); } if ((!frequent.length) && newProducts && newProducts.length) { newProducts.slice(0,4).forEach(item => frequent.push(item)); } %>

    <% if (!frequent.length) { %>
      <div class="empty-state">
        <p>No frequent items yet. Start shopping to build this list.</p>
      </div>
    <% } else { %>
      <div class="card-grid">
        <% frequent.slice(0,4).forEach(product => { %>
          <div class="product-card">
            <img src="/images/<%= product.image %>" alt="<%= product.productName %>">
            <h3 class="mt-2"><%= product.productName %></h3>
            <p class="subtle-text mb-1">Origin: <%= product.origin || 'Not specified' %></p>
            <div class="d-flex justify-content-between align-items-center">
              <span class="price-tag">$<%= Number(product.price || 0).toFixed(2) %></span>
              <a class="btn btn-link" href="/product/<%= product.id %>">See details</a>
            </div>
          </div>
        <% }) %>
      </div>
    <% } %>
  </section>
<% } %>

<%- include('partials/footer') %>
